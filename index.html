<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</title>
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playpen+Sans+Arabic:wght@100..800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Reem+Kufi+Fun:wght@400..700&display=swap" rel="stylesheet">
<style>
body { font-family: "Playpen Sans Arabic", cursive; direction: rtl; margin: 0 auto; }
label { display: block; margin-top: 1rem; font-size: 16px; }
input, button { font-family: "Playpen Sans Arabic", cursive;;margin-top: 0.3rem; padding: 0.5rem; font-size: 15px; }
button { background: #000000; color: white; border: none; cursor: pointer; border-radius: 4px; }
h2 { margin: 5rem 0 0 0; }
h3 { margin: 0; font-weight: 500; font-size: 13px; }
.container {margin: 50px;}
span.baldia { font-family: "Reem Kufi Fun", sans-serif; font-size: 5rem;}
.upload-area { border: 2px dashed #007bff; border-radius: 10px; padding: 2rem; text-align: center; background: #fff; cursor: pointer; } 
.upload-area.dragover { background: #e7f1ff; border-color: #0056b3; } 
.upload-area:hover { background: #f0f8ff; } 
.upload-area input { display: none; } 
.upload-text { font-size: 16px; color: #333; } 
.upload-text span { color: #007bff; font-weight: bold; }
.settings-area {margin:1rem}
.radio-group { display: flex; gap: 1rem; flex-wrap: wrap; align-items: flex-end; }
.radio-group label { display: flex; align-items: center; gap: 0.3rem; border: 2px solid transparent; border-radius: 6px;cursor: pointer; height: -webkit-fill-available; }
.radio-group label:has(input:checked) { border: 2px solid #007bff; box-shadow: 0 0 8px rgba(0, 123, 255, 0.6); border-radius: 6px; transition: box-shadow 0.2s ease, border-color 0.2s ease; }
.orientation-btn { display: flex; flex-direction: column; align-items: center; cursor: pointer; border: 1px solid transparent; padding: 4px; border-radius: 6px; transition: border 0.2s; } 
.orientation-btn input { display: none; } 
.orientation-btn input { display: none; } 
.orientation-preview { width: 30px; height: 40px; background: #fff; border: 2px solid transparent; box-sizing: border-box; margin-right: 4px; } 
.paper { display: inline-block; border: 2px solid #333; border-radius: 5px; background: #fff; margin-right: 5px; box-sizing: border-box; }
.paper.landscape { width: 60px; height: 40px; }
.paper.portrait { width: 40px; height: 60px; }
.page-btn { display: flex; flex-direction: column; align-items: center; cursor: pointer; border: 1px solid transparent; padding: 4px; border-radius: 6px; transition: border 0.2s; } 
.page-btn input { display: none; } 
.page-btn .grid { display: grid; gap: 2px; margin-bottom: 4px; } 
.grid-2 { grid-template-columns: repeat(2, 12px); grid-template-rows: 1fr; } 
.grid-2x2 { grid-template-columns: repeat(2, 12px); grid-template-rows: repeat(2,12px); } 
.grid-3x2 { grid-template-columns: repeat(3, 12px); grid-template-rows: repeat(2,12px); } 
.grid-4x2 { grid-template-columns: repeat(4, 12px); grid-template-rows: repeat(2,12px); } 
.grid span { display: block; width: 12px; height: 12px; background: #333; border-radius: 2px; } 
.frame-btn { display: flex; flex-direction: column; align-items: center; cursor: pointer; border: 1px solid transparent; padding: 4px; border-radius: 6px; transition: border 0.2s; } .page-btn input { display: none; } 
.frame-btn input { display: none; } 
.frame-preview { width: 60px; height: 50px; background: #fff; border: 2px solid transparent; box-sizing: border-box; margin-right: 4px; } 
.with-frame { border-color: #333; } 
.no-frame { border: 1px dashed #aaa; }
.alignment-btn { display: flex; flex-direction: column; align-items: center; cursor: pointer; border: 1px solid transparent; padding: 4px; border-radius: 6px; transition: border 0.2s; } .page-btn input { display: none; } 
.alignment-btn input { display: none; }
.alignment-btn .grid { display: grid; gap: 2px; align-items: center; margin-bottom: 4px; } 
.grid-ltr, .grid-rtl { grid-template-columns: repeat(3, 12px); grid-template-rows: 1fr; } 
.alignment-preview { width: 30px; height: 40px; background: #fff; border: 2px solid transparent; box-sizing: border-box; margin-right: 4px; } 
button#generate { margin-top: 50px; padding: 20px 70px; font-size: 1.2rem; }
</style>
</head>
<body>
<div class="container">
  <span class="baldia">Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</span><br>
  <h3>Ø·Ø¨Ø¹ Ø¨Ø²Ø§Ù Ø¯ÙŠØ§Ù„ Ø§Ù„ØµÙØ­Ø§Øª Ù ÙˆØ±Ù‚Ø© ÙˆØ­Ø¯Ø©</h3>
  <h2>Ø§Ø®ØªØ§Ø± Ù…Ù„Ù PDF :</h2>
  <div id="uploadArea" class="upload-area">
    <label for="pdfFile">
      <div class="upload-text">ğŸ“‚ Ø¯Ù‘ÙÙŠ Ø§Ù„Ù…Ù„Ù PDF ÙˆÙ„Ø§ Ø­Ø·Ù‘ÙÙˆ Ù‡Ù†Ø§</div>
      <div style="font-size: 0.9rem; color: gray;">(Ø³Ø­Ø¨ Ø£Ùˆ Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù)</div>
    </label>
    <input type="file" id="pdfFile" accept=".pdf">
    <div id="fileName" class="file-name"></div>
  </div>

  <div class="settigns-area">
    <h2>Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¯ÙŠØ§Ù„ Ø§Ù„ÙˆØ±Ù‚Ø© :</h2>
    <div class="radio-group">
      <label class="orientation-btn">
        <input type="radio" name="orientation" value="landscape" checked>
        <div class="paper landscape"></div> Ø£ÙÙ‚ÙŠ (paysage)
      </label>
      <label class="orientation-btn">
        <input type="radio" name="orientation" value="portrait">
        <div class="paper portrait"></div> Ø¹Ù…ÙˆØ¯ÙŠ (portrait)
      </label>
    </div>

    <h2>Ø´Ø­Ø§Ù„ Ù…Ù† ØµÙØ­Ø© Ù Ø§Ù„ÙˆØ±Ù‚Ø© :</h2>
    <div class="radio-group">
      <label class="page-btn">
        <input type="radio" name="pagesPerSheet" value="2" checked>
        <div class="grid grid-2">
          <span></span><span></span>
        </div>
        2 ØµÙØ­Ø§Øª
      </label>

      <label class="page-btn">
        <input type="radio" name="pagesPerSheet" value="4">
        <div class="grid grid-2x2">
          <span></span><span></span>
          <span></span><span></span>
        </div>
        4 ØµÙØ­Ø§Øª
      </label>

      <label class="page-btn">
        <input type="radio" name="pagesPerSheet" value="6">
        <div class="grid grid-3x2">
          <span></span><span></span><span></span>
          <span></span><span></span><span></span>
        </div>
        6 ØµÙØ­Ø§Øª
      </label>

      <label class="page-btn">
        <input type="radio" name="pagesPerSheet" value="8">
        <div class="grid grid-4x2">
          <span></span><span></span><span></span><span></span>
          <span></span><span></span><span></span><span></span>
        </div>
        8 ØµÙØ­Ø§Øª
      </label>
    </div>

    <h2>ØªØ¨ØºÙŠ ÙƒØ§Ø¯Ø± Ù„Ù„ØµÙØ­Ø©ØŸ :</h2>
    <div class="radio-group">
      <label class="frame-btn">
        <input type="radio" name="showFrame" value="yes" checked>
        <div class="frame-preview with-frame"></div> Ø¥ÙŠÙŠÙ‡ Ø§ÙŠÙŠÙ‡
      </label>
      <label class="frame-btn">
        <input type="radio" name="showFrame" value="no">
        <div class="frame-preview no-frame"></div> Ù„Ø§
      </label>
    </div>


    <h2>ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª :</h2>
    <div class="radio-group">
      <label class="alignment-btn">
        <input type="radio" name="alignment" value="ltr" checked>
          <div class="grid grid-ltr">
            <span></span> &#8594; <span></span>
        </div>
        Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„ÙŠÙ…ÙŠÙ†
      </label>
      <label class="alignment-btn">
        <input type="radio" name="alignment" value="rtl">
        <div class="grid grid-rtl">
            <span></span> &#8592; <span></span>
        </div>
        Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø±
      </label>
    </div>
  </div>
  <button id="generate">ğŸ“„ envoyer Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©</button>
  </div>
<script>
const fileInput = document.getElementById("pdfFile");
const generateBtn = document.getElementById("generate");
const orientationRadios = document.querySelectorAll('input[name="orientation"]');
const pagesRadios = document.querySelectorAll('input[name="pagesPerSheet"]');
const uploadArea = document.getElementById("uploadArea");
const fileNameDisplay = document.getElementById('fileName');

uploadArea.addEventListener('click', () => fileInput.click());

uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.classList.add('dragover');
});
uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (file && file.name.endsWith('.pdf')) {
    fileInput.files = e.dataTransfer.files;
    showFileName(file);
  } else {
    alert("âš ï¸ Ø¹ÙØ§Ùƒ Ø¯ÙŠØ± ØºÙŠØ± Ù…Ù„Ù PDF !");
  }
});

fileInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (file) showFileName(file);
});

function showFileName(file) {
  fileNameDisplay.textContent = `ğŸ“˜ Ø§Ù„Ù…Ù„Ù: ${file.name}`;
}

function updatePagesDefault() {
  const selectedOrientation = document.querySelector('input[name="orientation"]:checked').value;
  if (selectedOrientation === "portrait") {
    pagesRadios.forEach(r => r.checked = (r.value === "4"));
  } 
  else if (selectedOrientation === "landscape") {
    pagesRadios.forEach(r => r.checked = (r.value === "8"));
  }
}
updatePagesDefault();
orientationRadios.forEach(radio => {
  radio.addEventListener("change", updatePagesDefault);
});


generateBtn.addEventListener("click", async () => {
  const file = fileInput.files[0];
  if (!file) return alert('â›” Ø¹ÙØ§Ùƒ Ø§Ø®ØªØ§Ø± Ù…Ù„Ù PDF Ø§Ù„Ù„ÙˆÙ„!');

  const pagesPerSheet = parseInt(document.querySelector('input[name="pagesPerSheet"]:checked').value);
  const orientation = document.querySelector('input[name="orientation"]:checked').value;
  const showFrame = document.querySelector('input[name="showFrame"]:checked').value === "yes";
  const alignment = document.querySelector('input[name="alignment"]:checked').value;

  const arrayBuffer = await file.arrayBuffer();
  const sourcePdf = await PDFLib.PDFDocument.load(arrayBuffer);
  const mergedPdf = await PDFLib.PDFDocument.create();

  const totalPages = sourcePdf.getPageCount();
  const A4 = orientation === "landscape" ? [841.89, 595.28] : [595.28, 841.89];

  let cols, rows, verticalLayout = false;
  switch(pagesPerSheet) {
    case 2:
      if (orientation === "portrait") { cols=1; rows=2; } else { cols=2; rows=1; }
      break;
    case 4: cols=2; rows=2; break;
    case 6: cols=3; rows=2; verticalLayout=true; break;
    case 8: cols=4; rows=2; break;
  }

  const pageWidth = A4[0];
  const pageHeight = A4[1];
  const cellWidth = pageWidth / cols;
  const cellHeight = pageHeight / rows;

  for (let i=0;i<totalPages;i+=pagesPerSheet){
    const sheet = mergedPdf.addPage(A4);

    for (let j=0;j<pagesPerSheet;j++){
      const pageIndex=i+j;
      if(pageIndex>=totalPages) break;
      const [copiedPage] = await mergedPdf.copyPages(sourcePdf,[pageIndex]);
      const embedded = await sheet.doc.embedPage(copiedPage);

      let col,row;
      if(verticalLayout){ col=Math.floor(j/rows); row=j%rows; }
      else { row=Math.floor(j/cols); col=j%cols; }

      if(alignment==="rtl") col=cols-1-col;

      const x=col*cellWidth;
      const y=pageHeight-(row+1)*cellHeight;
      const scale=Math.min(cellWidth/embedded.width,cellHeight/embedded.height);

      sheet.drawPage(embedded,{x,y,xScale:scale,yScale:scale});

      if(showFrame){
        const frameWidth=embedded.width*scale;
        const frameHeight=embedded.height*scale;
        sheet.drawRectangle({x,y,width:frameWidth,height:frameHeight,borderColor:PDFLib.rgb(0,0,0),borderWidth:0.8});
      }

      const margin=5;
      sheet.drawText(`${pageIndex+1}`,{x:x+margin,y:y+margin,size:15,color:PDFLib.rgb(0.5,0.5,0.5),opacity:1});
    }
  }

  const pdfBytes = await mergedPdf.save();
  const blob = new Blob([pdfBytes],{type:"application/pdf"});
  const url = URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="baldia.pdf";
  a.click();
});
</script>

</body>
</html>
